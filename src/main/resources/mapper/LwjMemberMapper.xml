<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.changsoo.copypastestudy.lwj.mapper.LwjMemberMapper">
    <select id="selectLwjMemberList" resultType="lwjMemberVO" parameterType="lwjMemberVO"> -- 회원가입 신청 목록
        SELECT MEM_UID
             , REPLACE(MEM_NAME, SUBSTR(MEM_NAME, 2, 1), '*') AS mem_name
             , SUBSTR(MEM_PHONE, 1, 3) || '-' || '****' || '-' || SUBSTR(MEM_PHONE, 8) AS mem_phone
             , SUBSTR(MEM_REG_NUM, 1, 6) || '-' || SUBSTR(MEM_REG_NUM, 7, 1) || '******' AS mem_reg_num
             , MEM_CHK
             , MEM_RDO
             , MEM_DESC
          FROM TB_COMM_MEMBER_TEMP
        <where>
            <if test="memName != null and !memName.equals('')">
                AND MEM_NAME LIKE '%' || #{memName} || '%'
            </if>
            <if test="memPhone != null and !memPhone.equals('')">
                AND MEM_PHONE LIKE '%' || #{memPhone} || '%'
            </if>
            <if test="memRegNum != null and !memRegNum.equals('')">
                AND MEM_REG_NUM LIKE '%' || #{memRegNum} || '%'
            </if>
        </where>
        ORDER BY MEM_NAME
    </select>

    <select id="selectLwjMemberOne" resultType="lwjMemberVO" parameterType="lwjMemberVO"> -- 회원가입 승인 이벤트
        SELECT MEM_UID
             , MEM_NAME
             , MEM_PHONE
             , MEM_REG_NUM
             , MEM_CHK
             , MEM_RDO
             , MEM_DESC
        FROM TB_COMM_MEMBER_TEMP
       WHERE MEM_UID = #{memUid}
    </select>

    <insert id="insertLwjMemberTemp" parameterType="lwjMemberVO"> -- 회원가입 승인 신청
        INSERT INTO TB_COMM_MEMBER_TEMP
        ( MEM_UID
        , MEM_NAME
        , MEM_PHONE
        , MEM_REG_NUM
        , MEM_CHK
        , MEM_RDO
        , MEM_DESC
        , CREATE_DT
        ) VALUES
        ( SYS_GUID()
        , #{memName}
        , #{memPhone}
        , #{memRegNum}
        , #{memChk}
        , #{memRdo}
        , #{memDesc}
        , SYSDATE
        )
    </insert>

    <insert id="insertLwjMember" parameterType="lwjMemberVO"> -- 회원가입 최종 승인
        INSERT INTO TB_COMM_MEMBER
        ( MEM_UID
        , MEM_NAME
        , MEM_PHONE
        , MEM_REG_NUM
        , MEM_CHK
        , MEM_RDO
        , MEM_DESC
        , CREATE_DT
        ) SELECT MEM_UID
               , MEM_NAME
               , MEM_PHONE
               , MEM_REG_NUM
               , MEM_CHK
               , MEM_RDO
               , MEM_DESC
               , CREATE_DT
            FROM TB_COMM_MEMBER_TEMP
           WHERE MEM_UID = #{memUid}
    </insert>
</mapper>